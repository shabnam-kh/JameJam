<!DOCTYPE html>
<html lang="en">
<head>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <meta charset="UTF-8"/>
    <!-- Custom styles for this template -->
    <!--<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">-->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>-->
    <!--<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>-->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="js/information.js"></script>
    <script src="bower_components/handlebars/handlebars.js"></script>
    <script src="js/function.js"></script>
    <script src="js/values.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<title>Jame_Jam</title>

<!-- Bootstrap -->
    <!-- Bootstrap core CSS -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet">
    <style>
        .navbar-brand,
        .navbar-nav li a {
            line-height: 50px;
            height: 50px;
            padding-top: 0;
        }

        #logo {
            width: 150px;
            height: auto;
            border-top: none;
        }

        .large {
            font-size: 200%;
        }

        .btn {
            border: 1px solid grey;
            background-color: #d3d3d3;
        }

        .box {
            background-color: #afd9ee;
        }

        .row {
            background-color: #afd9ee;
        }

        .indicator {
            background-color: #000000;
            width: 10px;
            height: 10px;
            position: relative;
            z-index: 2;
            top: 10px;
        }

        .activeChillerBtn {
            position: relative;
            z-index: 1;
        }

        .chillerBtn {
            position: relative;
            z-index: 1;
        }

        .guid {
            background-color: darkgrey;
        }

        /*.indicator {*/
            /*background-color: red;*/
            /*width: 10px;*/
            /*height: 10px;*/
            /*position: relative;*/
            /*z-index: 2;*/
            /*top: 10px;*/
            /*color: #080808;*/
        /*}*/

        .indicatorText {
            float: right;
            position: relative;
            z-index: 3;

        }

        .G {
            background-color: dimgray;
        }

        .B {
            background-color: #000000;
        }
    </style>
</head>
<body>
<div class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">


            <a href="chillerList.html" class="navbar-brand"><img id="logo" src="img/imageedit_2_6147829167.bmp"></a>
        </div>

        <form class="navbar-form navbar-right login">
            <table>
                <tr>
                    <td><p>welcome userTTF </p></td>
                    <td> &nbsp &nbsp</td>
                    <td>
                        <!--<a href="javascript:action()"><span id="icon" class="glyphicon glyphicon-cog large" aria-hidden="true"></span></a>-->
                        <ul class="nav nav-pills nav-stacked">
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#"><span id="icon"
                                                                                                 class="glyphicon glyphicon-cog large"
                                                                                                 aria-hidden="true"></span></a>
                                <ul class="dropdown-menu">
                                    <li><a href="#">setting</a></li>
                                    <li><a href="javascript:action()">logout</a></li>
                                </ul>
                            </li>
                        </ul>
                    </td>
                    <td> &nbsp &nbsp</td>
                    <td>
                        <div class="indicator btn-danger"></div>
                        <span class="indicatorText">&nbsp &nbsp error</span>

                        </br>
                        <div class="indicator btn-success"></div>
                        <span class="indicatorText">&nbsp run</span>
                    </td>
                </tr>
            </table>
        </form>

    </div>
</div>

<div class="container" id="chillers">
    <!--<div class="alert alert-warning" role="button">connect</div>-->
    <div class="alert alert-danger auth" role="alertdialog" style="display: none">Unauthorized user, you should login first</div>
    <div class="alert alert-danger connection" role="alertdialog" style="display: none">there is no information for this chiller in database</div>
    <div class="row">
    <div class="col-md-5 box">
           <table>
       <tr>


               <!--<input  type="button" class="btn" value="Shiraz Doctors Building" disabled/>-->

       </tr>
       <tr>
           <td><div class="indicator 1"></div>
               <button class="activeChillerBtn" id="1"
                       onclick="getActiveChiller(this.value)" value="chiller 01">Shiraz</br>Doctors</br>Building</button>
           </td>
           <td><div class="indicator 11"></div>
               <button class="chillerBtn" id="11"
                       onclick="getActiveChiller(this.value)" value="chiller 11">chiller&nbsp&nbsp&nbsp</br>#</br>11&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 21"></div>
               <button class="chillerBtn" id="21"
                       onclick="getActiveChiller(this.value)" value="chiller 21">chiller&nbsp&nbsp&nbsp</br>#</br>21&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 31"></div>
               <button class="chillerBtn" id="31"
                       onclick="getActiveChiller(this.value)" value="chiller 31">chiller&nbsp&nbsp&nbsp</br>#</br>31&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 41"></div>
               <button class="chillerBtn" id="41"
                       onclick="getActiveChiller(this.value)" value="chiller 41">chiller&nbsp&nbsp&nbsp</br>#</br>41&nbsp&nbsp&nbsp</button></td>
       </tr>
       <tr>
               <td><div class="indicator 2"></div>
                   <button class="chillerBtn" id="2"
                       onclick="getActiveChiller(this.value)" value="chiller 02">chiller&nbsp&nbsp&nbsp</br>#</br>02&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 12"></div>
               <button class="chillerBtn" id="12"
                       onclick="getActiveChiller(this.value)" value="chiller 12">chiller&nbsp&nbsp&nbsp</br>#</br>12&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 22"></div>
               <button class="chillerBtn" id="22"
                       onclick="getActiveChiller(this.value)" value="chiller 22" >chiller&nbsp&nbsp&nbsp</br>#</br>22&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 32"></div>
               <button class="chillerBtn" id="32"
                       onclick="getActiveChiller(this.value)" value="chiller 32">chiller&nbsp&nbsp&nbsp</br>#</br>32&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 42"></div>
               <button class="chillerBtn" id="42"
                       onclick="getActiveChiller(this.value)" value="chiller 42">chiller&nbsp&nbsp&nbsp</br>#</br>42&nbsp&nbsp&nbsp</button></td>
       </tr>
         <tr>
              <td><div class="indicator 3"></div>
                  <button class="chillerBtn" id="3"
                       onclick="getActiveChiller(this.value)" value="chiller 03">chiller&nbsp&nbsp&nbsp</br>#</br>03&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 13"></div>
               <button class="chillerBtn" id="13"
                       onclick="getActiveChiller(this.value)" value="chiller 13">chiller&nbsp&nbsp&nbsp</br>#</br>13&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 23"></div>
               <button class="chillerBtn" id="23"
                       onclick="getActiveChiller(this.value)" value="chiller 23">chiller&nbsp&nbsp&nbsp</br>#</br>23&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 33"></div>
               <button class="chillerBtn" id="33"
                       onclick="getActiveChiller(this.value)" value="chiller 33">chiller&nbsp&nbsp&nbsp</br>#</br>33&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 43"></div>
               <button class="chillerBtn" id="43"
                       onclick="getActiveChiller(this.value)" value="chiller 43">chiller&nbsp&nbsp&nbsp</br>#</br>43&nbsp&nbsp&nbsp</button></td>
       </tr>
         <tr>
            <td><div class="indicator 4"></div>
                <button class="chillerBtn" id="4"
                       onclick="getActiveChiller(this.value)" value="chiller 04">chiller&nbsp&nbsp&nbsp</br>#</br>04&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 14"></div>
               <button class="chillerBtn" id="14"
                       onclick="getActiveChiller(this.value)" value="chiller 14">chiller&nbsp&nbsp&nbsp</br>#</br>14&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 24"></div>
               <button class="chillerBtn" id="24"
                       onclick="getActiveChiller(this.value)" value="chiller 24">chiller&nbsp&nbsp&nbsp</br>#</br>24&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 34"></div>
               <button class="chillerBtn" id="34"
                       onclick="getActiveChiller(this.value)" value="chiller 34">chiller&nbsp&nbsp&nbsp</br>#</br>34&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 44"></div>
               <button class="chillerBtn" id="44"
                       onclick="getActiveChiller(this.value)" value="chiller 44">chiller&nbsp&nbsp&nbsp</br>#</br>44&nbsp&nbsp&nbsp</button></td>
       </tr>
           <tr>
              <td><div class="indicator 5"></div>
                  <button class="chillerBtn" id="5"
                       onclick="getActiveChiller(this.value)" value="chiller 05">chiller&nbsp&nbsp&nbsp</br>#</br>05&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 15"></div>
               <button class="chillerBtn" id="15"
                       onclick="getActiveChiller(this.value)" value="chiller 15">chiller&nbsp&nbsp&nbsp</br>#</br>15&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 25"></div>
               <button class="chillerBtn" id="25"
                       onclick="getActiveChiller(this.value)" value="chiller 25">chiller&nbsp&nbsp&nbsp</br>#</br>25&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 35"></div>
               <button class="chillerBtn" id="35"
                       onclick="getActiveChiller(this.value)" value="chiller 35">chiller&nbsp&nbsp&nbsp</br>#</br>35&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 45"></div>
               <button class="chillerBtn" id="45"
                       onclick="getActiveChiller(this.value)" value="chiller 45">chiller&nbsp&nbsp&nbsp</br>#</br>45&nbsp&nbsp&nbsp</button></td>
       </tr>
           <tr>
            <td><div class="indicator 6"></div>
                <button class="chillerBtn" id="6"
                       onclick="getActiveChiller(this.value)" value="chiller 06">chiller&nbsp&nbsp&nbsp</br>#</br>06&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 16"></div>
               <button class="chillerBtn" id="16"
                       onclick="getActiveChiller(this.value)" value="chiller 16">chiller&nbsp&nbsp&nbsp</br>#</br>16&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 26"></div>
               <button class="chillerBtn" id="26"
                       onclick="getActiveChiller(this.value)" value="chiller 26">chiller&nbsp&nbsp&nbsp</br>#</br>26&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 36"></div>
               <button class="chillerBtn" id="36"
                       onclick="getActiveChiller(this.value)" value="chiller 36">chiller&nbsp&nbsp&nbsp</br>#</br>36&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 46"></div>
               <button class="chillerBtn" id="46"
                       onclick="getActiveChiller(this.value)" value="chiller 46">chiller&nbsp&nbsp&nbsp</br>#</br>46&nbsp&nbsp&nbsp</button></td>
       </tr>
             <tr>
           <td><div class="indicator 7"></div>
               <button class="chillerBtn" id="7"
                       onclick="getActiveChiller(this.value)" value="chiller 07">chiller&nbsp&nbsp&nbsp</br>#</br>42&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 17"></div>
               <button class="chillerBtn" id="17"
                       onclick="getActiveChiller(this.value)" value="chiller 17">chiller&nbsp&nbsp&nbsp</br>#</br>17&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 27"></div>
               <button class="chillerBtn" id="27"
                       onclick="getActiveChiller(this.value)" value="chiller 27">chiller&nbsp&nbsp&nbsp</br>#</br>27&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 37"></div>
               <button class="chillerBtn" id="37"
                       onclick="getActiveChiller(this.value)" value="chiller 37">chiller&nbsp&nbsp&nbsp</br>#</br>37&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 47"></div>
               <button class="chillerBtn" id="47"
                       onclick="getActiveChiller(this.value)" value="chiller 47">chiller&nbsp&nbsp&nbsp</br>#</br>47&nbsp&nbsp&nbsp</button></td>
       </tr>
             <tr>
             <td><div class="indicator 8"></div>
                 <button class="chillerBtn" id="8"
                       onclick="getActiveChiller(this.value)" value="chiller 08">chiller&nbsp&nbsp&nbsp</br>#</br>08&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 18"></div>
               <button class="chillerBtn" id="18"
                       onclick="getActiveChiller(this.value)" value="chiller 18">chiller&nbsp&nbsp&nbsp</br>#</br>18&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 28"></div>
               <button class="chillerBtn" id="28"
                       onclick="getActiveChiller(this.value)" value="chiller 28">chiller&nbsp&nbsp&nbsp</br>#</br>28&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 38"></div>
               <button class="chillerBtn" id="38"
                       onclick="getActiveChiller(this.value)" value="chiller 38">chiller&nbsp&nbsp&nbsp</br>#</br>38&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 48"></div>
               <button class="chillerBtn" id="48"
                       onclick="getActiveChiller(this.value)" value="chiller 48">chiller&nbsp&nbsp&nbsp</br>#</br>48&nbsp&nbsp&nbsp</button></td>
       </tr>
           <tr>
        <td><div class="indicator 9"></div>
            <button class="chillerBtn" id="9"
                       onclick="getActiveChiller(this.value)" value="chiller 09">chiller&nbsp&nbsp&nbsp</br>#</br>09&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 19"></div>
               <button class="chillerBtn" id="19"
                       onclick="getActiveChiller(this.value)" value="chiller 19">chiller&nbsp&nbsp&nbsp</br>#</br>19&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 29"></div>
               <button class="chillerBtn" id="29"
                       onclick="getActiveChiller(this.value)" value="chiller 29">chiller&nbsp&nbsp&nbsp</br>#</br>29&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 39"></div>
               <button class="chillerBtn" id="39"
                       onclick="getActiveChiller(this.value)" value="chiller 39">chiller&nbsp&nbsp&nbsp</br>#</br>39&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 49"></div>
               <button class="chillerBtn" id="49"
                       onclick="getActiveChiller(this.value)" value="chiller 49">chiller&nbsp&nbsp&nbsp</br>#</br>49&nbsp&nbsp&nbsp</button></td>
       </tr>
           <tr>
              <td><div class="indicator 10"></div>
                  <button class="chillerBtn" id="10"
                       onclick="getActiveChiller(this.value)" value="chiller 10">chiller&nbsp&nbsp&nbsp</br>#</br>10&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 20"></div>
               <button class="chillerBtn" id="20"
                       onclick="getActiveChiller(this.value)" value="chiller 20">chiller&nbsp&nbsp&nbsp</br>#</br>20&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 30"></div>
               <button class="chillerBtn" id="30"
                       onclick="getActiveChiller(this.value)" value="chiller 30">chiller&nbsp&nbsp&nbsp</br>#</br>30&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 40"></div>
               <button class="chillerBtn" id="40"
                       onclick="getActiveChiller(this.value)" value="chiller 40">chiller&nbsp&nbsp&nbsp</br>#</br>40&nbsp&nbsp&nbsp</button></td>
           <td><div class="indicator 50"></div>
               <button class="chillerBtn" id="50"
                       onclick="getActiveChiller(this.value)" value="chiller 50">chiller&nbsp&nbsp&nbsp</br>#</br>50&nbsp&nbsp&nbsp</button></td>
       </tr>

   </table>
    </div>
        <div class="col-md-5 box guid">
            <div class="indicator btn-danger"></div>
            <p>&nbsp &nbsp &nbsp error</p>
            </br>
            <div class="indicator btn-success"></div>
            <p>&nbsp &nbsp &nbsp run</p>
            </br>
            <div class="indicator btn-warning"></div>
            <p>&nbsp &nbsp &nbsp warning</p>
            </br>
            <div class="indicator B"></div>
            <p>&nbsp &nbsp &nbsp disconnect</p>
            </br>
            <div class="indicator G"></div>
            <p>&nbsp &nbsp &nbsp stop</p>
            </br>
        </div>
    </div>
    <div class="form-group">
        <textarea class="form-control" rows="5" id="warning"></textarea>
    </div>
</div>
<script>
    $(document).ready(function(){
        var chID;
        var permission=sessionStorage.getItem("userPermission");
        console.log("user permission chiller is "+permission);

        var myvar=setInterval(function(){
            for(var i=1;i<=chillerCount;i++){
            var tmp=getChillerNumber($("#"+i).val());
            if(permission.indexOf(tmp)!=-1){
                console.log(+"is active");

            }else{
                $("#"+i).attr('disabled',true);
            }
            //var chID;
            if(i<10){
                chID="0"+i;
            }else{
                chID=i;
            }
            //console.log("request data for chiller "+chID);
            reqChillerData(function(err){
                //console.log(err);
            },function(data){
             var JsonData = JSON.parse(data);
                tempBoundsAlarm(JsonData,chID)
                var alarmData = JsonData.Alarm;
                var idChill=JsonData.Chiller_no;
                var j;
                if(idChill<10){
                    j=idChill[1];
            }else{
                    j=idChill;
            }
                var digi = alarmData.split(",");
            var flag = digi.indexOf("1");
            if(flag!=-1){
                console.log("chiller "+idChill+" has alarm")
                $("."+j).addClass("btn-danger")
            }else{
                $("."+j).addClass("btn-success")
            }
        },chID)

        }
        },5000)

    })

    function getActiveChiller(val) {
        sessionStorage.setItem('activeChiller', val);
        console.log('set activeChiller ' + sessionStorage.getItem('activeChiller'));
        getSecureId(function (id) {
//                  $.get(
//        baseUrl+"/chillerInfo",
//                {id:getChillerNumber(val),sID:id},
//        function( rawdata, textStatus, jqXHR) {
//               if(jqXHR.status===202){
//                   sessionStorage.setItem('chillerInfo', rawdata);
//                   console.log(rawdata);
//                   location.href='templates/chillerInfo.html';
//
//           }else{
//                     $(".alert-danger").show();
//           }
//
//});
////TODO success and error
            $.ajax(
                    {
                        url: serverURL + "/chillerInfo",
                        data: {id: getChillerNumber(val), sID: id},
                        success: function (data, textStatus, jqXHR) {

                            sessionStorage.setItem('chillerInfo', data);
                            console.log(data);
                            location.href = 'templates/chillerInfo.html';
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(errorThrown);
                             if(jqXHR.status==401){
                         $(".auth").show();
                     }else{
                         $(".connection").show();
                     }
                        }
                    }
            )
        })


    }

    function action() {

        var r = confirm("Do you want to LogOut ??!!");
        if (r == true) {
            console.log("user logout");
            getSecureId(function (id) {
                $.ajax(
                        {
                            url: serverURL + "/logout",
                            data: {id: id},
                            success: function (data, textStatus, jqXHR) {
                                console.log(data);
                                location.href = 'index.html';
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                console.log("logout error " + errorThrown)
                            }
                        }
                )
            })
        } else {
            console.log("user not logout");
        }

    }
    ;
    function getSecureId(callback) {
        var sID = sessionStorage.getItem('secureID');
        console.log("secureID is " + sID);
        callback(sID);
    }
</script>
</body>
</html>